{"version":3,"file":"addEvent-88f89cec.js","sources":["../../../../pages/Info/addEvent.vue"],"sourcesContent":["<template>\r\n  <n-button @click=\"showModal = true\" type=\"success\" class=\"mt-4\">\r\n    发布活动\r\n  </n-button>\r\n  <n-modal\r\n      v-model:show=\"showModal\"\r\n      preset=\"dialog\"\r\n      title=\"确认\"\r\n      content=\"你确认?\"\r\n      positive-text=\"确认\"\r\n      negative-text=\"取消\"\r\n      @positive-click=\"submitCallback\"\r\n      @negative-click=\"cancelCallback\"\r\n  >\r\n    <n-card title=\"发布活动\">\r\n      <div>\r\n      <input\r\n          type=\"file\"\r\n          class=\"upload\"\r\n          @change=\"onFileSelected\"\r\n          ref=\"inputer\"\r\n          accept=\"image/png,image/jpeg,image/gif,image/jpg\"\r\n      />\r\n<!--      <input type=\"text\" v-model=\"imageName\" placeholder=\"请输入图片名称\" />-->\r\n<!--      <button @click=\"onUpload\">确认</button>-->\r\n      </div>\r\n      <n-form\r\n          ref=\"formRef\"\r\n          :model=\"model.value\"\r\n          :rules=\"rules\"\r\n          label-placement=\"left\"\r\n          label-width=\"auto\"\r\n          require-mark-placement=\"right-hanging\"\r\n          :size=\"'medium'\"\r\n          :style=\"{\r\n      maxWidth: '640px'\r\n    }\"\r\n      >\r\n        <n-form-item label=\"活动名称\" path=\"name\">\r\n          <n-input :span=\"12\" v-model:value=\"model.name\" placeholder=\"输入活动名称\"/>\r\n        </n-form-item>\r\n        <n-form-item label=\"志愿时长\" path=\"time\">\r\n          <n-input-number :span=\"12\" v-model:value=\"model.time\" placeholder=\"输入志愿时长\"/>\r\n        </n-form-item>\r\n        <n-form-item label=\"开始时间\" path=\"beginTime\">\r\n          <n-date-picker :span=\"12\" v-model:value=\"model.beginTime\" type=\"datetime\"/>\r\n        </n-form-item>\r\n        <n-form-item label=\"结束时间\" path=\"lateTime\">\r\n          <n-date-picker :span=\"12\" v-model:value=\"model.lateTime\" type=\"datetime\"/>\r\n        </n-form-item>\r\n        <n-form-item label=\"活动地点\" path=\"location\">\r\n          <n-input :span=\"12\" v-model:value=\"model.location\" placeholder=\"输入活动地点\"/>\r\n        </n-form-item>\r\n        <n-form-item label=\"最多参与人数\" path=\"maxpeople\">\r\n          <n-input :span=\"12\" v-model:value=\"model.maxpeople\" placeholder=\"输入参与人数\"/>\r\n        </n-form-item>\r\n      </n-form>\r\n    </n-card>\r\n  </n-modal>\r\n</template>\r\n\r\n<script lang=\"ts\" setup>\r\nimport {ref} from 'vue'\r\nimport {FormInst, useMessage} from 'naive-ui'\r\nimport {useSquareStore} from \"~/stores/squareStore\";\r\nimport {ArchiveOutline as ArchiveIcon} from '@vicons/ionicons5'\r\nimport {storeToRefs} from \"pinia\";\r\nimport axios from \"axios\";\r\nimport api from \"~/api/api\";\r\n\r\nconst formRef = ref<FormInst | null>(null)\r\nconst model = ref({\r\n  name: '',\r\n  time: '',\r\n  beginTime: null,\r\n  lateTime: null,\r\n  location: '',\r\n  maxpeople: ''\r\n})\r\n\r\nconst rules = ref({\r\n  name: {\r\n    required: true,\r\n    trigger: ['blur', 'input'],\r\n    message: '请输入活动名称'\r\n  },\r\n  time: {\r\n    type: 'number',\r\n    required: true,\r\n    trigger: ['blur', 'input'],\r\n    message: '请输入志愿时长'\r\n  },\r\n  beginTime: {\r\n    type: 'number',\r\n    required: true,\r\n    trigger: ['blur', 'change'],\r\n    message: '请输入 datetimeValue'\r\n  },\r\n  lateTime: {\r\n    type: 'number',\r\n    required: true,\r\n    trigger: ['blur', 'change'],\r\n    message: '请输入 datetimeValue'\r\n  },\r\n  location: {\r\n    required: true,\r\n    trigger: ['blur', 'input'],\r\n    message: '请输入活动地点'\r\n  },\r\n  maxpeople: {\r\n    required: true,\r\n    trigger: ['blur', 'input'],\r\n    message: '请输入人数'\r\n  },\r\n})\r\n\r\nconst message = useMessage()\r\nconst showModal = ref(false)\r\n\r\nfunction submitCallback():void {\r\n  const date1 = model.value.beginTime\r\n  const date2 = model.value.lateTime\r\n  const beginTime = new Date(date1)\r\n  const lateTime = new Date(date2)\r\n  console.log(JSON.stringify(beginTime.toLocaleString()))\r\n\r\n  const data = {\r\n    name: model.value.name,\r\n    time: model.value.time,\r\n    beginTime: beginTime.toLocaleString(),\r\n    lateTime: lateTime.toLocaleString(),\r\n    location: model.value.location,\r\n    maxpeople: model.value.maxpeople\r\n  }\r\n  axios.post(api+'/Admin/releaseActivity',data,{\r\n    headers: {token: sessionStorage.getItem('token')}\r\n  })\r\n      .then((response) => {\r\n        useSquareStore().squareStore = model.value\r\n        console.log(response.data)\r\n        message.success('发布成功')\r\n      })\r\n      .catch((errors) => {\r\n        console.log(errors)\r\n        message.error('发布失败')\r\n      })\r\n\r\n// 图片上传\r\n  if (!selectedFile) {\r\n    return;\r\n  }\r\n  const formData = new FormData();\r\n  formData.append(\"file\", selectedFile);\r\n  formData.append('name', model.value.name);\r\n  uploadImg(formData);\r\n\r\n\r\n}\r\n\r\nlet selectedFile: File | null = null;\r\n// let imageName: string = model.value.name\r\n\r\nfunction onFileSelected(e: Event): void {\r\n  selectedFile = (e.target as HTMLInputElement).files?.[0];\r\n}\r\n\r\nasync function uploadImg(formData: FormData): Promise<void> {\r\n  const res = await axios.post(api+\"/upload\", formData, {\r\n    headers: { \"Content-Type\": \"multipart/form-data\" },\r\n  });\r\n  console.log(res.data.md5);\r\n}\r\n\r\n// function onUpload(): void {\r\n//   if (!selectedFile) {\r\n//     return;\r\n//   }\r\n//   const formData = new FormData();\r\n//   formData.append(\"file\", selectedFile);\r\n//   formData.append('name', imageName);\r\n//   uploadImg(formData);\r\n// }\r\n\r\n\r\n\r\n\r\nfunction cancelCallback() {\r\n  message.warning('取消')\r\n}\r\n\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"],"names":[],"mappings":"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"}